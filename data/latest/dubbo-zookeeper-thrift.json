ew==
ICAiaW5mbyI6IHs=
ICAgICJhdXRob3IiOiAicm9jeXVhbiIs
ICAgICJhdXRob3JfZW1haWwiOiAiYWRtaW5Acm9jeXVhbi5jb20iLA==
ICAgICJidWd0cmFja191cmwiOiBudWxsLA==
ICAgICJjbGFzc2lmaWVycyI6IFs=
ICAgICAgIkludGVuZGVkIEF1ZGllbmNlIDo6IERldmVsb3BlcnMiLA==
ICAgICAgIkxpY2Vuc2UgOjogT1NJIEFwcHJvdmVkIDo6IE1JVCBMaWNlbnNlIiw=
ICAgICAgIk9wZXJhdGluZyBTeXN0ZW0gOjogT1MgSW5kZXBlbmRlbnQiLA==
ICAgICAgIlByb2dyYW1taW5nIExhbmd1YWdlIDo6IFB5dGhvbiI=
ICAgIF0s
ICAgICJkZXNjcmlwdGlvbiI6ICI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZHViYm9fem9va2VlcGVyX3RocmlmdCA6XG5cbnRocmlmdFNlcnZlck1hbmFnZXIgPSBUaHJpZnRTZXJ2ZXJNYW5hZ2VyKFwiMTI3LjAuMC4xOjIxODFcIik7XG50aHJpZnRTZXJ2ZXJNYW5hZ2VyLmdldFNlcnZpY2VTZXJ2aWNlSW5mbyhcInRocmlmdDp1c2VyU2VydmljZVwiKTtcblxuPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cblxud2hhdCBpcyBpbnNpZGVcbj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5weXRob25fem9va2VlcGVyX3RocmlmdFxuOjpcbiAqIOS4uuS6hmR1YmJv6ICM5YaZ55qEXG4gKiBweXRob24gc2V0dXAucHkgcmVnaXN0ZXI7IHB5dGhvbiBzZXR1cC5weSBzZGlzdCB1cGxvYWRcbiAqIOS4u+imgeaYr+S7jnpvb2tlZXBlcuS4reaLv+WIsOacjeWKoeWZqOiKgueCueS/oeaBryAoaXA6cG9ydDpzZXJ2aWNlTmFtZSlcbiAqIOS9v+W+l+WuouaIt+err+eahOiwg+eUqOWPqumcgOimgSBzZXJ2aWNlTmFtZeWNs+WPr1xuXG4gKiBg5LulIOW3peWOguaWueazleabv+aNouS6hmlwb3J0YWzph4znmoQgbWFrZV9jbGllbnTov4fnqIss5Y2z5Yqo5oCB55Sf5oiQdGhyaWZ0IOmHjOeahCBtYWtlX2NsaWVudCgp5Lqn55Sf55qE5a6e5L6LYFxuXG4gKiBgIOWwhiBjbGllbnTlrp7kvovpnZnmgIHnvJPlrZgs5bqU6K+l5Y+v5Lul5Yqg5b+raXBvcnRhbOeahOiuv+mXruaViOeOhyBgXG5cblxuXG5cbiAqIOi/meS4qumhueebruaJgOWBmueahOS6iyDlhbblrp7lsLHmmK/miopkdWJib+a6kOeggemHjOeahOi/memDqOWIhuS7o+eggSDnlKhweXRob24g5a6e546w5LqG6ICM5beyLOS7juiAjOS9v+W+l3B5dGhvbueahHRocmlmdOWuouaIt+err+eahOiwg+eUqFxuICAg5Y+v5Lul6ISx56a7SVDogIzlrZjlnKgs5LiN5Zyo5Y67566h5o+Q5L6b5pyN5Yqh5o+Q5L6b6ICF55qESVDlkoznq6/lj6Pov5jmnInmmK/lkKblgZzmraLmj5DkvpvmnI3liqFcblxuXG53aGF0IGlzIG5leHRcbj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG46OlxuXG4gICAgcHVibGljIGNsYXNzIFpvb2tlZXBlclJlZ2lzdHJ5IGV4dGVuZHMgRmFpbGJhY2tSZWdpc3RyeSB7XG5cbiAgICAgICAgcHJpdmF0ZSBmaW5hbCBzdGF0aWMgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKFpvb2tlZXBlclJlZ2lzdHJ5LmNsYXNzKTtcblxuICAgICAgICBwcml2YXRlIGZpbmFsIHN0YXRpYyBpbnQgREVGQVVMVF9aT09LRUVQRVJfUE9SVCA9IDIxODE7XG5cbiAgICAgICAgcHJpdmF0ZSBmaW5hbCBzdGF0aWMgU3RyaW5nIERFRkFVTFRfUk9PVCA9IFwiZHViYm9cIjtcblxuICAgICAgICBwcml2YXRlIGZpbmFsIFN0cmluZyAgICAgICAgcm9vdDtcblxuICAgICAgICBwcml2YXRlIGZpbmFsIFNldDxTdHJpbmc+IGFueVNlcnZpY2VzID0gbmV3IENvbmN1cnJlbnRIYXNoU2V0PFN0cmluZz4oKTtcblxuICAgICAgICBwcml2YXRlIGZpbmFsIENvbmN1cnJlbnRNYXA8VVJMLCBDb25jdXJyZW50TWFwPE5vdGlmeUxpc3RlbmVyLCBDaGlsZExpc3RlbmVyPj4gemtMaXN0ZW5lcnMgPSBuZXcgQ29uY3VycmVudEhhc2hNYXA8VVJMLCBDb25jdXJyZW50TWFwPE5vdGlmeUxpc3RlbmVyLCBDaGlsZExpc3RlbmVyPj4oKTtcblxuICAgICAgICBwcml2YXRlIGZpbmFsIFpvb2tlZXBlckNsaWVudCB6a0NsaWVudDtcblxuICAgICAgICBwdWJsaWMgWm9va2VlcGVyUmVnaXN0cnkoVVJMIHVybCwgWm9va2VlcGVyVHJhbnNwb3J0ZXIgem9va2VlcGVyVHJhbnNwb3J0ZXIpIHtcbiAgICAgICAgICAgIHN1cGVyKHVybCk7XG4gICAgICAgICAgICBpZiAodXJsLmlzQW55SG9zdCgpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbihcInJlZ2lzdHJ5IGFkZHJlc3MgPT0gbnVsbFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFN0cmluZyBncm91cCA9IHVybC5nZXRQYXJhbWV0ZXIoQ29uc3RhbnRzLkdST1VQX0tFWSwgREVGQVVMVF9ST09UKTtcbiAgICAgICAgICAgIGlmICghIGdyb3VwLnN0YXJ0c1dpdGgoQ29uc3RhbnRzLlBBVEhfU0VQQVJBVE9SKSkge1xuICAgICAgICAgICAgICAgIGdyb3VwID0gQ29uc3RhbnRzLlBBVEhfU0VQQVJBVE9SICsgZ3JvdXA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnJvb3QgPSBncm91cDtcbiAgICAgICAgICAgIHprQ2xpZW50ID0gem9va2VlcGVyVHJhbnNwb3J0ZXIuY29ubmVjdCh1cmwpO1xuICAgICAgICAgICAgemtDbGllbnQuYWRkU3RhdGVMaXN0ZW5lcihuZXcgU3RhdGVMaXN0ZW5lcigpIHtcbiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBzdGF0ZUNoYW5nZWQoaW50IHN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PSBSRUNPTk5FQ1RFRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNvdmVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlLmdldE1lc3NhZ2UoKSwgZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHB1YmxpYyBib29sZWFuIGlzQXZhaWxhYmxlKCkge1xuICAgICAgICAgICAgcmV0dXJuIHprQ2xpZW50LmlzQ29ubmVjdGVkKCk7XG4gICAgICAgIH1cblxuICAgICAgICBwdWJsaWMgdm9pZCBkZXN0cm95KCkge1xuICAgICAgICAgICAgc3VwZXIuZGVzdHJveSgpO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB6a0NsaWVudC5jbG9zZSgpO1xuICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHtcbiAgICAgICAgICAgICAgICBsb2dnZXIud2FybihcIkZhaWxlZCB0byBjbG9zZSB6b29rZWVwZXIgY2xpZW50IFwiICsgZ2V0VXJsKCkgKyBcIiwgY2F1c2U6IFwiICsgZS5nZXRNZXNzYWdlKCksIGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcHJvdGVjdGVkIHZvaWQgZG9SZWdpc3RlcihVUkwgdXJsKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHprQ2xpZW50LmNyZWF0ZSh0b1VybFBhdGgodXJsKSwgdXJsLmdldFBhcmFtZXRlcihDb25zdGFudHMuRFlOQU1JQ19LRVksIHRydWUpKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSBlKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJwY0V4Y2VwdGlvbihcIkZhaWxlZCB0byByZWdpc3RlciBcIiArIHVybCArIFwiIHRvIHpvb2tlZXBlciBcIiArIGdldFVybCgpICsgXCIsIGNhdXNlOiBcIiArIGUuZ2V0TWVzc2FnZSgpLCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIGRvVW5yZWdpc3RlcihVUkwgdXJsKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHprQ2xpZW50LmRlbGV0ZSh0b1VybFBhdGgodXJsKSk7XG4gICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBScGNFeGNlcHRpb24oXCJGYWlsZWQgdG8gdW5yZWdpc3RlciBcIiArIHVybCArIFwiIHRvIHpvb2tlZXBlciBcIiArIGdldFVybCgpICsgXCIsIGNhdXNlOiBcIiArIGUuZ2V0TWVzc2FnZSgpLCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIGRvU3Vic2NyaWJlKGZpbmFsIFVSTCB1cmwsIGZpbmFsIE5vdGlmeUxpc3RlbmVyIGxpc3RlbmVyKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGlmIChDb25zdGFudHMuQU5ZX1ZBTFVFLmVxdWFscyh1cmwuZ2V0U2VydmljZUludGVyZmFjZSgpKSkge1xuICAgICAgICAgICAgICAgICAgICBTdHJpbmcgcm9vdCA9IHRvUm9vdFBhdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgQ29uY3VycmVudE1hcDxOb3RpZnlMaXN0ZW5lciwgQ2hpbGRMaXN0ZW5lcj4gbGlzdGVuZXJzID0gemtMaXN0ZW5lcnMuZ2V0KHVybCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcnMgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgemtMaXN0ZW5lcnMucHV0SWZBYnNlbnQodXJsLCBuZXcgQ29uY3VycmVudEhhc2hNYXA8Tm90aWZ5TGlzdGVuZXIsIENoaWxkTGlzdGVuZXI+KCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXJzID0gemtMaXN0ZW5lcnMuZ2V0KHVybCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgQ2hpbGRMaXN0ZW5lciB6a0xpc3RlbmVyID0gbGlzdGVuZXJzLmdldChsaXN0ZW5lcik7XG4gICAgICAgICAgICAgICAgICAgIGlmICh6a0xpc3RlbmVyID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RlbmVycy5wdXRJZkFic2VudChsaXN0ZW5lciwgbmV3IENoaWxkTGlzdGVuZXIoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgY2hpbGRDaGFuZ2VkKFN0cmluZyBwYXJlbnRQYXRoLCBMaXN0PFN0cmluZz4gY3VycmVudENoaWxkcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKFN0cmluZyBjaGlsZCA6IGN1cnJlbnRDaGlsZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkID0gVVJMLmRlY29kZShjaGlsZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoISBhbnlTZXJ2aWNlcy5jb250YWlucyhjaGlsZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbnlTZXJ2aWNlcy5hZGQoY2hpbGQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmliZSh1cmwuc2V0UGF0aChjaGlsZCkuYWRkUGFyYW1ldGVycyhDb25zdGFudHMuSU5URVJGQUNFX0tFWSwgY2hpbGQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25zdGFudHMuQ0hFQ0tfS0VZLCBTdHJpbmcudmFsdWVPZihmYWxzZSkpLCBsaXN0ZW5lcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHprTGlzdGVuZXIgPSBsaXN0ZW5lcnMuZ2V0KGxpc3RlbmVyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB6a0NsaWVudC5jcmVhdGUocm9vdCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBMaXN0PFN0cmluZz4gc2VydmljZXMgPSB6a0NsaWVudC5hZGRDaGlsZExpc3RlbmVyKHJvb3QsIHprTGlzdGVuZXIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VydmljZXMgIT0gbnVsbCAmJiBzZXJ2aWNlcy5zaXplKCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKFN0cmluZyBzZXJ2aWNlIDogc2VydmljZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlID0gVVJMLmRlY29kZShzZXJ2aWNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbnlTZXJ2aWNlcy5hZGQoc2VydmljZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlKHVybC5zZXRQYXRoKHNlcnZpY2UpLmFkZFBhcmFtZXRlcnMoQ29uc3RhbnRzLklOVEVSRkFDRV9LRVksIHNlcnZpY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25zdGFudHMuQ0hFQ0tfS0VZLCBTdHJpbmcudmFsdWVPZihmYWxzZSkpLCBsaXN0ZW5lcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBMaXN0PFVSTD4gdXJscyA9IG5ldyBBcnJheUxpc3Q8VVJMPigpO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKFN0cmluZyBwYXRoIDogdG9DYXRlZ29yaWVzUGF0aCh1cmwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBDb25jdXJyZW50TWFwPE5vdGlmeUxpc3RlbmVyLCBDaGlsZExpc3RlbmVyPiBsaXN0ZW5lcnMgPSB6a0xpc3RlbmVycy5nZXQodXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcnMgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHprTGlzdGVuZXJzLnB1dElmQWJzZW50KHVybCwgbmV3IENvbmN1cnJlbnRIYXNoTWFwPE5vdGlmeUxpc3RlbmVyLCBDaGlsZExpc3RlbmVyPigpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lcnMgPSB6a0xpc3RlbmVycy5nZXQodXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIENoaWxkTGlzdGVuZXIgemtMaXN0ZW5lciA9IGxpc3RlbmVycy5nZXQobGlzdGVuZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHprTGlzdGVuZXIgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RlbmVycy5wdXRJZkFic2VudChsaXN0ZW5lciwgbmV3IENoaWxkTGlzdGVuZXIoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIGNoaWxkQ2hhbmdlZChTdHJpbmcgcGFyZW50UGF0aCwgTGlzdDxTdHJpbmc+IGN1cnJlbnRDaGlsZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFpvb2tlZXBlclJlZ2lzdHJ5LnRoaXMubm90aWZ5KHVybCwgbGlzdGVuZXIsIHRvVXJsc1dpdGhFbXB0eSh1cmwsIHBhcmVudFBhdGgsIGN1cnJlbnRDaGlsZHMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHprTGlzdGVuZXIgPSBsaXN0ZW5lcnMuZ2V0KGxpc3RlbmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHprQ2xpZW50LmNyZWF0ZShwYXRoLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBMaXN0PFN0cmluZz4gY2hpbGRyZW4gPSB6a0NsaWVudC5hZGRDaGlsZExpc3RlbmVyKHBhdGgsIHprTGlzdGVuZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkcmVuICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxzLmFkZEFsbCh0b1VybHNXaXRoRW1wdHkodXJsLCBwYXRoLCBjaGlsZHJlbikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG5vdGlmeSh1cmwsIGxpc3RlbmVyLCB1cmxzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBScGNFeGNlcHRpb24oXCJGYWlsZWQgdG8gc3Vic2NyaWJlIFwiICsgdXJsICsgXCIgdG8gem9va2VlcGVyIFwiICsgZ2V0VXJsKCkgKyBcIiwgY2F1c2U6IFwiICsgZS5nZXRNZXNzYWdlKCksIGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcHJvdGVjdGVkIHZvaWQgZG9VbnN1YnNjcmliZShVUkwgdXJsLCBOb3RpZnlMaXN0ZW5lciBsaXN0ZW5lcikge1xuICAgICAgICAgICAgQ29uY3VycmVudE1hcDxOb3RpZnlMaXN0ZW5lciwgQ2hpbGRMaXN0ZW5lcj4gbGlzdGVuZXJzID0gemtMaXN0ZW5lcnMuZ2V0KHVybCk7XG4gICAgICAgICAgICBpZiAobGlzdGVuZXJzICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBDaGlsZExpc3RlbmVyIHprTGlzdGVuZXIgPSBsaXN0ZW5lcnMuZ2V0KGxpc3RlbmVyKTtcbiAgICAgICAgICAgICAgICBpZiAoemtMaXN0ZW5lciAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHprQ2xpZW50LnJlbW92ZUNoaWxkTGlzdGVuZXIodG9VcmxQYXRoKHVybCksIHprTGlzdGVuZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHB1YmxpYyBMaXN0PFVSTD4gbG9va3VwKFVSTCB1cmwpIHtcbiAgICAgICAgICAgIGlmICh1cmwgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oXCJsb29rdXAgdXJsID09IG51bGxcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIExpc3Q8U3RyaW5nPiBwcm92aWRlcnMgPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4oKTtcbiAgICAgICAgICAgICAgICBmb3IgKFN0cmluZyBwYXRoIDogdG9DYXRlZ29yaWVzUGF0aCh1cmwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBMaXN0PFN0cmluZz4gY2hpbGRyZW4gPSB6a0NsaWVudC5nZXRDaGlsZHJlbihwYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZHJlbiAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXJzLmFkZEFsbChjaGlsZHJlbik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0b1VybHNXaXRob3V0RW1wdHkodXJsLCBwcm92aWRlcnMpO1xuICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIGUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUnBjRXhjZXB0aW9uKFwiRmFpbGVkIHRvIGxvb2t1cCBcIiArIHVybCArIFwiIGZyb20gem9va2VlcGVyIFwiICsgZ2V0VXJsKCkgKyBcIiwgY2F1c2U6IFwiICsgZS5nZXRNZXNzYWdlKCksIGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBTdHJpbmcgdG9Sb290RGlyKCkge1xuICAgICAgICAgICAgaWYgKHJvb3QuZXF1YWxzKENvbnN0YW50cy5QQVRIX1NFUEFSQVRPUikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcm9vdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByb290ICsgQ29uc3RhbnRzLlBBVEhfU0VQQVJBVE9SO1xuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBTdHJpbmcgdG9Sb290UGF0aCgpIHtcbiAgICAgICAgICAgIHJldHVybiByb290O1xuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBTdHJpbmcgdG9TZXJ2aWNlUGF0aChVUkwgdXJsKSB7XG4gICAgICAgICAgICBTdHJpbmcgbmFtZSA9IHVybC5nZXRTZXJ2aWNlSW50ZXJmYWNlKCk7XG4gICAgICAgICAgICBpZiAoQ29uc3RhbnRzLkFOWV9WQUxVRS5lcXVhbHMobmFtZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdG9Sb290UGF0aCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRvUm9vdERpcigpICsgVVJMLmVuY29kZShuYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHByaXZhdGUgU3RyaW5nW10gdG9DYXRlZ29yaWVzUGF0aChVUkwgdXJsKSB7XG4gICAgICAgICAgICBTdHJpbmdbXSBjYXRlZ3JvaWVzO1xuICAgICAgICAgICAgaWYgKENvbnN0YW50cy5BTllfVkFMVUUuZXF1YWxzKHVybC5nZXRQYXJhbWV0ZXIoQ29uc3RhbnRzLkNBVEVHT1JZX0tFWSkpKSB7XG4gICAgICAgICAgICAgICAgY2F0ZWdyb2llcyA9IG5ldyBTdHJpbmdbXSB7Q29uc3RhbnRzLlBST1ZJREVSU19DQVRFR09SWSwgQ29uc3RhbnRzLkNPTlNVTUVSU19DQVRFR09SWSxcbiAgICAgICAgICAgICAgICAgICAgICAgIENvbnN0YW50cy5ST1VURVJTX0NBVEVHT1JZLCBDb25zdGFudHMuQ09ORklHVVJBVE9SU19DQVRFR09SWX07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNhdGVncm9pZXMgPSB1cmwuZ2V0UGFyYW1ldGVyKENvbnN0YW50cy5DQVRFR09SWV9LRVksIG5ldyBTdHJpbmdbXSB7Q29uc3RhbnRzLkRFRkFVTFRfQ0FURUdPUll9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFN0cmluZ1tdIHBhdGhzID0gbmV3IFN0cmluZ1tjYXRlZ3JvaWVzLmxlbmd0aF07XG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNhdGVncm9pZXMubGVuZ3RoOyBpICsrKSB7XG4gICAgICAgICAgICAgICAgcGF0aHNbaV0gPSB0b1NlcnZpY2VQYXRoKHVybCkgKyBDb25zdGFudHMuUEFUSF9TRVBBUkFUT1IgKyBjYXRlZ3JvaWVzW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHBhdGhzO1xuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBTdHJpbmcgdG9DYXRlZ29yeVBhdGgoVVJMIHVybCkge1xuICAgICAgICAgICAgcmV0dXJuIHRvU2VydmljZVBhdGgodXJsKSArIENvbnN0YW50cy5QQVRIX1NFUEFSQVRPUiArIHVybC5nZXRQYXJhbWV0ZXIoQ29uc3RhbnRzLkNBVEVHT1JZX0tFWSwgQ29uc3RhbnRzLkRFRkFVTFRfQ0FURUdPUlkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBTdHJpbmcgdG9VcmxQYXRoKFVSTCB1cmwpIHtcbiAgICAgICAgICAgIHJldHVybiB0b0NhdGVnb3J5UGF0aCh1cmwpICsgQ29uc3RhbnRzLlBBVEhfU0VQQVJBVE9SICsgVVJMLmVuY29kZSh1cmwudG9GdWxsU3RyaW5nKCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBMaXN0PFVSTD4gdG9VcmxzV2l0aG91dEVtcHR5KFVSTCBjb25zdW1lciwgTGlzdDxTdHJpbmc+IHByb3ZpZGVycykge1xuICAgICAgICAgICAgTGlzdDxVUkw+IHVybHMgPSBuZXcgQXJyYXlMaXN0PFVSTD4oKTtcbiAgICAgICAgICAgIGlmIChwcm92aWRlcnMgIT0gbnVsbCAmJiBwcm92aWRlcnMuc2l6ZSgpID4gMCkge1xuICAgICAgICAgICAgICAgIGZvciAoU3RyaW5nIHByb3ZpZGVyIDogcHJvdmlkZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb3ZpZGVyID0gVVJMLmRlY29kZShwcm92aWRlcik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm92aWRlci5jb250YWlucyhcIjovL1wiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgVVJMIHVybCA9IFVSTC52YWx1ZU9mKHByb3ZpZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChVcmxVdGlscy5pc01hdGNoKGNvbnN1bWVyLCB1cmwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJscy5hZGQodXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1cmxzO1xuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBMaXN0PFVSTD4gdG9VcmxzV2l0aEVtcHR5KFVSTCBjb25zdW1lciwgU3RyaW5nIHBhdGgsIExpc3Q8U3RyaW5nPiBwcm92aWRlcnMpIHtcbiAgICAgICAgICAgIExpc3Q8VVJMPiB1cmxzID0gdG9VcmxzV2l0aG91dEVtcHR5KGNvbnN1bWVyLCBwcm92aWRlcnMpO1xuICAgICAgICAgICAgaWYgKHVybHMgPT0gbnVsbCB8fCB1cmxzLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIGludCBpID0gcGF0aC5sYXN0SW5kZXhPZignLycpO1xuICAgICAgICAgICAgICAgIFN0cmluZyBjYXRlZ29yeSA9IGkgPCAwID8gcGF0aCA6IHBhdGguc3Vic3RyaW5nKGkgKyAxKTtcbiAgICAgICAgICAgICAgICBVUkwgZW1wdHkgPSBjb25zdW1lci5zZXRQcm90b2NvbChDb25zdGFudHMuRU1QVFlfUFJPVE9DT0wpLmFkZFBhcmFtZXRlcihDb25zdGFudHMuQ0FURUdPUllfS0VZLCBjYXRlZ29yeSk7XG4gICAgICAgICAgICAgICAgdXJscy5hZGQoZW1wdHkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHVybHM7XG4gICAgICAgIH1cblxuICAgICAgICBzdGF0aWMgU3RyaW5nIGFwcGVuZERlZmF1bHRQb3J0KFN0cmluZyBhZGRyZXNzKSB7XG4gICAgICAgICAgICBpZiAoYWRkcmVzcyAhPSBudWxsICYmIGFkZHJlc3MubGVuZ3RoKCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgaW50IGkgPSBhZGRyZXNzLmluZGV4T2YoJzonKTtcbiAgICAgICAgICAgICAgICBpZiAoaSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFkZHJlc3MgKyBcIjpcIiArIERFRkFVTFRfWk9PS0VFUEVSX1BPUlQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChJbnRlZ2VyLnBhcnNlSW50KGFkZHJlc3Muc3Vic3RyaW5nKGkgKyAxKSkgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWRkcmVzcy5zdWJzdHJpbmcoMCwgaSArIDEpICsgREVGQVVMVF9aT09LRUVQRVJfUE9SVDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYWRkcmVzcztcbiAgICAgICAgfVxuXG4gICAgfVxuXG5cbmBgYCIs
ICAgICJkZXNjcmlwdGlvbl9jb250ZW50X3R5cGUiOiBudWxsLA==
ICAgICJkb2NzX3VybCI6IG51bGws
ICAgICJkb3dubG9hZF91cmwiOiAiVU5LTk9XTiIs
ICAgICJkb3dubG9hZHMiOiB7
ICAgICAgImxhc3RfZGF5IjogLTEs
ICAgICAgImxhc3RfbW9udGgiOiAtMSw=
ICAgICAgImxhc3Rfd2VlayI6IC0x
ICAgIH0s
ICAgICJob21lX3BhZ2UiOiAiaHR0cDovL3d3dy5yb2N5dWFuLmNvbSIs
ICAgICJrZXl3b3JkcyI6ICJweXRob24gd2VjaGF0IGR1YmJvX3pvb2tlZXBlcl90aHJpZnQgYXBpIiw=
ICAgICJsaWNlbnNlIjogIk1JVCIs
ICAgICJtYWludGFpbmVyIjogbnVsbCw=
ICAgICJtYWludGFpbmVyX2VtYWlsIjogbnVsbCw=
ICAgICJuYW1lIjogImR1YmJvX3pvb2tlZXBlcl90aHJpZnQiLA==
ICAgICJwYWNrYWdlX3VybCI6ICJodHRwczovL3B5cGkub3JnL3Byb2plY3QvZHViYm9fem9va2VlcGVyX3RocmlmdC8iLA==
ICAgICJwbGF0Zm9ybSI6ICJVTktOT1dOIiw=
ICAgICJwcm9qZWN0X3VybCI6ICJodHRwczovL3B5cGkub3JnL3Byb2plY3QvZHViYm9fem9va2VlcGVyX3RocmlmdC8iLA==
ICAgICJwcm9qZWN0X3VybHMiOiB7
ICAgICAgIkRvd25sb2FkIjogIlVOS05PV04iLA==
ICAgICAgIkhvbWVwYWdlIjogImh0dHA6Ly93d3cucm9jeXVhbi5jb20i
ICAgIH0s
ICAgICJyZWxlYXNlX3VybCI6ICJodHRwczovL3B5cGkub3JnL3Byb2plY3QvZHViYm9fem9va2VlcGVyX3RocmlmdC8xLjAuMS8iLA==
ICAgICJyZXF1aXJlc19kaXN0IjogbnVsbCw=
ICAgICJyZXF1aXJlc19weXRob24iOiBudWxsLA==
ICAgICJzdW1tYXJ5IjogImEgcHl0aG9uIGxpYmVyYXJpZXMgIGZvciBkdWJib196b29rZWVwZXJfdGhyaWZ0IHR1dG9yaWFsLiIs
ICAgICJ2ZXJzaW9uIjogIjEuMC4xIiw=
ICAgICJ5YW5rZWQiOiBmYWxzZSw=
ICAgICJ5YW5rZWRfcmVhc29uIjogbnVsbA==
ICB9LA==
ICAibGFzdF9zZXJpYWwiOiAxOTYyODk0LA==
ICAicmVsZWFzZXMiOiB7
ICAgICIxLjAuMSI6IFs=
ICAgICAgew==
ICAgICAgICAiY29tbWVudF90ZXh0IjogIiIs
ICAgICAgICAiZGlnZXN0cyI6IHs=
ICAgICAgICAgICJibGFrZTJiXzI1NiI6ICJjOGQxMTI5ZGY4ZTkxYTgyMTIyZDQzZjE4YTM4NjBmMTkzOTIwZThmODM1MTc3MTg3OWU0ODZjYmUzMzBhOWQyIiw=
ICAgICAgICAgICJtZDUiOiAiNGZjOTI0YzBjNDc1YzQ4OGVhMGMyZjQzNzA4M2VkMDciLA==
ICAgICAgICAgICJzaGEyNTYiOiAiOTZhMTU2MzEyZmVlNGMyMWRlNjdjM2JiNmFhMDViZjNlMTVkMTAzN2NiNGJkYmZiYzdlODQxMzdmM2NlMjVmZCI=
ICAgICAgICB9LA==
ICAgICAgICAiZG93bmxvYWRzIjogLTEs
ICAgICAgICAiZmlsZW5hbWUiOiAiZHViYm9fem9va2VlcGVyX3RocmlmdC0xLjAuMS50YXIuZ3oiLA==
ICAgICAgICAiaGFzX3NpZyI6IGZhbHNlLA==
ICAgICAgICAibWQ1X2RpZ2VzdCI6ICI0ZmM5MjRjMGM0NzVjNDg4ZWEwYzJmNDM3MDgzZWQwNyIs
ICAgICAgICAicGFja2FnZXR5cGUiOiAic2Rpc3QiLA==
ICAgICAgICAicHl0aG9uX3ZlcnNpb24iOiAic291cmNlIiw=
ICAgICAgICAicmVxdWlyZXNfcHl0aG9uIjogbnVsbCw=
ICAgICAgICAic2l6ZSI6IDEwMTMwLA==
ICAgICAgICAidXBsb2FkX3RpbWUiOiAiMjAxNi0wMi0xOFQwOTozNjoyMiIs
ICAgICAgICAidXBsb2FkX3RpbWVfaXNvXzg2MDEiOiAiMjAxNi0wMi0xOFQwOTozNjoyMi44ODIyODRaIiw=
ICAgICAgICAidXJsIjogImh0dHBzOi8vZmlsZXMucHl0aG9uaG9zdGVkLm9yZy9wYWNrYWdlcy9jOC9kMS8xMjlkZjhlOTFhODIxMjJkNDNmMThhMzg2MGYxOTM5MjBlOGY4MzUxNzcxODc5ZTQ4NmNiZTMzMGE5ZDIvZHViYm9fem9va2VlcGVyX3RocmlmdC0xLjAuMS50YXIuZ3oiLA==
ICAgICAgICAieWFua2VkIjogZmFsc2Us
ICAgICAgICAieWFua2VkX3JlYXNvbiI6IG51bGw=
ICAgICAgfQ==
ICAgIF0=
ICB9LA==
ICAidXJscyI6IFs=
ICAgIHs=
ICAgICAgImNvbW1lbnRfdGV4dCI6ICIiLA==
ICAgICAgImRpZ2VzdHMiOiB7
ICAgICAgICAiYmxha2UyYl8yNTYiOiAiYzhkMTEyOWRmOGU5MWE4MjEyMmQ0M2YxOGEzODYwZjE5MzkyMGU4ZjgzNTE3NzE4NzllNDg2Y2JlMzMwYTlkMiIs
ICAgICAgICAibWQ1IjogIjRmYzkyNGMwYzQ3NWM0ODhlYTBjMmY0MzcwODNlZDA3Iiw=
ICAgICAgICAic2hhMjU2IjogIjk2YTE1NjMxMmZlZTRjMjFkZTY3YzNiYjZhYTA1YmYzZTE1ZDEwMzdjYjRiZGJmYmM3ZTg0MTM3ZjNjZTI1ZmQi
ICAgICAgfSw=
ICAgICAgImRvd25sb2FkcyI6IC0xLA==
ICAgICAgImZpbGVuYW1lIjogImR1YmJvX3pvb2tlZXBlcl90aHJpZnQtMS4wLjEudGFyLmd6Iiw=
ICAgICAgImhhc19zaWciOiBmYWxzZSw=
ICAgICAgIm1kNV9kaWdlc3QiOiAiNGZjOTI0YzBjNDc1YzQ4OGVhMGMyZjQzNzA4M2VkMDciLA==
ICAgICAgInBhY2thZ2V0eXBlIjogInNkaXN0Iiw=
ICAgICAgInB5dGhvbl92ZXJzaW9uIjogInNvdXJjZSIs
ICAgICAgInJlcXVpcmVzX3B5dGhvbiI6IG51bGws
ICAgICAgInNpemUiOiAxMDEzMCw=
ICAgICAgInVwbG9hZF90aW1lIjogIjIwMTYtMDItMThUMDk6MzY6MjIiLA==
ICAgICAgInVwbG9hZF90aW1lX2lzb184NjAxIjogIjIwMTYtMDItMThUMDk6MzY6MjIuODgyMjg0WiIs
ICAgICAgInVybCI6ICJodHRwczovL2ZpbGVzLnB5dGhvbmhvc3RlZC5vcmcvcGFja2FnZXMvYzgvZDEvMTI5ZGY4ZTkxYTgyMTIyZDQzZjE4YTM4NjBmMTkzOTIwZThmODM1MTc3MTg3OWU0ODZjYmUzMzBhOWQyL2R1YmJvX3pvb2tlZXBlcl90aHJpZnQtMS4wLjEudGFyLmd6Iiw=
ICAgICAgInlhbmtlZCI6IGZhbHNlLA==
ICAgICAgInlhbmtlZF9yZWFzb24iOiBudWxs
ICAgIH0=
ICBdLA==
ICAidnVsbmVyYWJpbGl0aWVzIjogW10=
fQ==
